<!doctype html>
<html lang="id">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <title>SIMDOKPOL - {{ .Title }}</title>
    <link rel="icon" type="image/x-icon" href="/static/img/favicon.ico" />
    <link href="/static/vendor/fontawesome-free/css/all.min.css" rel="stylesheet" />
    <link href="/static/fonts/nunito.css" rel="stylesheet" />
    <link href="/static/css/sb-admin-2.min.css" rel="stylesheet" />
    <link href="/static/vendor/sweetalert2/sweetalert2.min.css" rel="stylesheet" />
    <link href="/static/css/custom.css" rel="stylesheet" />
</head>
<body class="bg-gradient-primary">
    <div class="container">
        <div class="card o-hidden border-0 shadow-lg my-5">
            <div class="card-body p-0">
                <div class="row">
                    <div class="col-lg-10 mx-auto">
                        <div class="p-5">
                            <div class="text-center">
                                <h1 class="h4 text-gray-900 mb-4">Konfigurasi Awal</h1>
                                <p class="mb-4">Silakan lengkapi konfigurasi di bawah ini agar aplikasi dapat berjalan.</p>
                            </div>

                            <ul class="nav nav-pills nav-fill mb-3" id="setupTab" role="tablist">
                                <li class="nav-item">
                                    <a class="nav-link active" id="new-setup-tab" data-toggle="tab" href="#new-setup" role="tab"><i class="fas fa-magic mr-2"></i>Konfigurasi Baru</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" id="restore-setup-tab" data-toggle="tab" href="#restore-setup" role="tab"><i class="fas fa-history mr-2"></i>Pulihkan Backup</a>
                                </li>
                            </ul>

                            <div class="tab-content" id="setupTabContent">
                                <div class="tab-pane fade show active" id="new-setup" role="tabpanel">
                                    <form id="setup-form">
                                        
                                        <div class="stepper-slide active" id="slide-1">
                                            <hr>
                                            <h5 class="text-primary mb-3">Langkah 1: Pilih Database</h5>
                                            <div class="form-group">
                                                <label>Jenis Database</label>
                                                <select id="db_dialect" class="form-control form-control-lg">
                                                    <option value="sqlite" {{if eq .CurrentConfig.DBDialect "sqlite"}}selected{{end}}>SQLite (Lokal / Tanpa Server)</option>
                                                    <option value="mysql" {{if eq .CurrentConfig.DBDialect "mysql"}}selected{{end}}>MySQL (Server / LAN)</option>
                                                    <option value="postgres" {{if eq .CurrentConfig.DBDialect "postgres"}}selected{{end}}>PostgreSQL (Server / Cloud)</option>
                                                </select>
                                                <small class="text-muted">Pilih SQLite jika hanya digunakan di satu komputer.</small>
                                            </div>
                                            <button type="button" class="btn btn-primary btn-block next-step mt-4">
                                                Lanjut <i class="fas fa-arrow-right ml-2"></i>
                                            </button>
                                        </div>

                                        <div class="stepper-slide" id="slide-2">
                                            <hr>
                                            <h5 class="text-primary mb-3">Langkah 2: Koneksi Database</h5>
                                            
                                            <div class="form-row">
                                                <div class="form-group col-md-8">
                                                    <label>Host / IP Address</label>
                                                    <input type="text" class="form-control" id="db_host" placeholder="127.0.0.1">
                                                </div>
                                                <div class="form-group col-md-4">
                                                    <label>Port</label>
                                                    <input type="text" class="form-control" id="db_port" placeholder="3306">
                                                </div>
                                            </div>
                                            <div class="form-row">
                                                <div class="form-group col-md-6">
                                                    <label>Nama Database</label>
                                                    <input type="text" class="form-control" id="db_name" placeholder="simdokpol">
                                                </div>
                                                <div class="form-group col-md-6">
                                                    <label>Username</label>
                                                    <input type="text" class="form-control" id="db_user" placeholder="root">
                                                </div>
                                            </div>
                                            
                                            <div class="form-group">
                                                <label>Password</label>
                                                <div class="password-wrapper">
                                                    <input type="password" class="form-control" id="db_pass">
                                                    <button type="button" class="btn btn-link password-peek" data-target="#db_pass" aria-label="Tampilkan password database">
                                                        <i class="fas fa-eye"></i>
                                                    </button>
                                                </div>
                                            </div>

                                            <div class="form-group bg-light p-3 rounded border" id="pg-ssl-group" style="display: none;">
                                                <label class="font-weight-bold text-dark small">MODE SSL (ENKRIPSI)</label>
                                                <select id="db_sslmode" class="form-control form-control-sm">
                                                    <option value="disable">Disable (Lokal / Tanpa SSL)</option>
                                                    <option value="require">Require (Wajib SSL - Untuk Cloud)</option>
                                                    <option value="verify-full">Verify Full (Sangat Aman)</option>
                                                </select>
                                                <small class="text-muted mt-1 d-block">Gunakan 'Require' jika menggunakan database cloud seperti Supabase/Neon.</small>
                                            </div>

                                            <button type="button" class="btn btn-info btn-block mb-3" id="test-db-btn"><i class="fas fa-plug mr-2"></i>Tes Koneksi</button>
                                            
                                            <div class="d-flex justify-content-between">
                                                <button type="button" class="btn btn-secondary prev-step"><i class="fas fa-arrow-left mr-2"></i>Kembali</button>
                                                <button type="button" class="btn btn-primary next-step">Lanjut <i class="fas fa-arrow-right ml-2"></i></button>
                                            </div>
                                        </div>

                                        <div class="stepper-slide" id="slide-3">
                                            <hr>
                                            <h5 class="text-primary mb-3">Langkah 3: Identitas Instansi</h5>
                                            <div class="form-group"><input type="text" class="form-control auto-uppercase" id="kop_baris_1" placeholder="Baris 1 (e.g. KEPOLISIAN NEGARA)" required></div>
                                            <div class="form-group"><input type="text" class="form-control auto-uppercase" id="kop_baris_2" placeholder="Baris 2 (e.g. DAERAH JATIM)" required></div>
                                            <div class="form-group"><input type="text" class="form-control auto-uppercase" id="kop_baris_3" placeholder="Baris 3 (e.g. RESOR SURABAYA)" required></div>
                                            <div class="form-row">
                                                <div class="col-6"><input type="text" class="form-control auto-titlecase" id="nama_kantor" placeholder="Nama Kantor" required></div>
                                                <div class="col-6"><input type="text" class="form-control auto-titlecase" id="tempat_surat" placeholder="Tempat Terbit" required></div>
                                            </div>
                                            <div class="d-flex justify-content-between mt-4">
                                                <button type="button" class="btn btn-secondary prev-step"><i class="fas fa-arrow-left mr-2"></i>Kembali</button>
                                                <button type="button" class="btn btn-primary next-step">Lanjut <i class="fas fa-arrow-right ml-2"></i></button>
                                            </div>
                                        </div>

                                        <div class="stepper-slide" id="slide-4">
                                            <hr>
                                            <h5 class="text-primary mb-3">Langkah 4: Penomoran & Arsip</h5>
                                            <div class="form-row">
                                                <div class="col-6">
                                                    <label>Kode Surat</label>
                                                    <input type="text" class="form-control auto-uppercase" id="kode_surat" value="SKH" required>
                                                </div>
                                                <div class="col-6">
                                                    <label>Kode Arsip</label>
                                                    <input type="text" class="form-control auto-uppercase" id="kode_arsip" value="TUK.7.2.1" required>
                                                </div>
                                            </div>
                                            <div class="form-group mt-2">
                                                <label>Format Nomor</label>
                                                <input type="text" class="form-control" id="format_nomor_surat" value="{KODE_SURAT}/{NOMOR}/{BULAN_ROMAWI}/{KODE_ARSIP}/{TAHUN}" required>
                                                <small class="text-muted">Token: {KODE_SURAT}, {NOMOR}, {BULAN_ROMAWI}, {KODE_ARSIP}, {TAHUN}</small>
                                            </div>
                                            <div class="form-row">
                                                <div class="col-6"><label>No. Terakhir</label><input type="number" class="form-control" id="nomor_surat_terakhir" value="0" required></div>
                                                <div class="col-6"><label>Lama Arsip (Hari)</label><input type="number" class="form-control" id="archive_duration_days" value="15" required></div>
                                            </div>
                                            <div class="form-group mt-2">
                                                <label>Zona Waktu</label>
                                                <select id="zona_waktu" class="form-control">
                                                    <option value="Asia/Jakarta">WIB (Jakarta)</option>
                                                    <option value="Asia/Makassar" selected>WITA (Makassar)</option>
                                                    <option value="Asia/Jayapura">WIT (Jayapura)</option>
                                                </select>
                                            </div>
                                            <div class="d-flex justify-content-between mt-4">
                                                <button type="button" class="btn btn-secondary prev-step"><i class="fas fa-arrow-left mr-2"></i>Kembali</button>
                                                <button type="button" class="btn btn-primary next-step">Lanjut <i class="fas fa-arrow-right ml-2"></i></button>
                                            </div>
                                        </div>

                                        <div class="stepper-slide" id="slide-5">
                                            <hr>
                                            <h5 class="text-primary mb-3">Langkah 5: Akun Super Admin</h5>
                                            <div class="form-group"><label>Nama Lengkap</label><input type="text" class="form-control auto-uppercase" id="admin_nama_lengkap" required></div>
                                            <div class="form-row">
                                                <div class="col-6"><label>NRP</label><input type="text" class="form-control" id="admin_nrp" required></div>
                                                <div class="col-6"><label>Pangkat</label><input type="text" class="form-control auto-uppercase" id="admin_pangkat" required></div>
                                            </div>
                                            <div class="form-group mt-3">
                                                <label>Jabatan</label>
                                                <input type="text" class="form-control auto-uppercase" id="admin_jabatan" required>
                                            </div>
                                            
                                            <div class="form-row">
                                                <div class="col-6">
                                                    <label>Password</label>
                                                    <div class="password-wrapper">
                                                        <input type="password" class="form-control" id="admin_password" minlength="8" required>
                                                        <button type="button" class="btn btn-link password-peek" data-target="#admin_password" aria-label="Tampilkan password admin">
                                                            <i class="fas fa-eye"></i>
                                                        </button>
                                                    </div>
                                                </div>
                                                <div class="col-6">
                                                    <label>Konfirmasi</label>
                                                    <div class="password-wrapper">
                                                        <input type="password" class="form-control" id="admin_password_confirm" required>
                                                        <button type="button" class="btn btn-link password-peek" data-target="#admin_password_confirm" aria-label="Tampilkan konfirmasi password admin">
                                                            <i class="fas fa-eye"></i>
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="d-flex justify-content-between mt-4">
                                                <button type="button" class="btn btn-secondary prev-step"><i class="fas fa-arrow-left mr-2"></i>Kembali</button>
                                                <button type="submit" class="btn btn-success btn-lg"><i class="fas fa-check-circle mr-2"></i>Selesai & Simpan</button>
                                            </div>
                                        </div>

                                    </form>
                                </div>

                                <div class="tab-pane fade" id="restore-setup" role="tabpanel">
                                    <div class="alert alert-info mt-4">Upload file <code>.db</code> dari instalasi lama untuk memulihkan semua data.</div>
                                    <form id="restore-setup-form">
                                        <div class="custom-file mb-3">
                                            <input type="file" class="custom-file-input" id="restore-file" accept=".db" required>
                                            <label class="custom-file-label">Pilih File Backup...</label>
                                        </div>
                                        <button type="submit" class="btn btn-danger btn-block"><i class="fas fa-history mr-2"></i>Pulihkan Database</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="/static/vendor/jquery/jquery.min.js"></script>
    <script src="/static/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="/static/vendor/sweetalert2/sweetalert2.all.min.js"></script>
    {{template "_setupScript.html" .}}
</body>
</html>
